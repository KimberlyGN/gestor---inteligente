<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestor Inteligente</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="container">

    <h1>Gestor Inteligente</h1>

    <!-- ========================= -->
    <!-- AN√ÅLISIS -->
    <!-- ========================= -->

    <div class="card">
        <h2>An√°lisis Inteligente</h2>

        <div class="resumen">
            <div class="stat">
                <span>Total</span>
                <strong>{{ analisis.total }}</strong>
            </div>
            <div class="stat">
                <span>Completadas</span>
                <strong>{{ analisis.completadas }}</strong>
            </div>
            <div class="stat">
                <span>Pendientes</span>
                <strong>{{ analisis.pendientes }}</strong>
            </div>
        </div>

        <p class="mensaje" data-porcentaje="{{ analisis.porcentaje }}">
            {{ analisis.mensaje }}
        </p>

        <div class="barra-container">
            <div class="barra" data-porcentaje="{{ analisis.porcentaje }}">
                {{ analisis.porcentaje }}%
            </div>
        </div>

        {% if analisis.porcentaje == 100 %}
            <div class="medalla">
                üèÜ Productividad M√°xima Activada
            </div>
        {% endif %}
    </div>

    <!-- ========================= -->
    <!-- AGREGAR ACTIVIDAD -->
    <!-- ========================= -->

    <div class="card">
        <h2>Agregar Actividad</h2>

        <form method="POST" action="/agregar" class="form">
            <input type="text" name="titulo" placeholder="T√≠tulo" required>
            <input type="text" name="categoria" placeholder="Categor√≠a" required>
            <button type="submit" class="btn-primary">Agregar</button>
        </form>
    </div>

    <!-- ========================= -->
    <!-- LISTA DE ACTIVIDADES -->
    <!-- ========================= -->

    <div class="card">
        <h2>Lista de Actividades</h2>

        {% if actividades %}
            <div class="grid">
                {% for act in actividades %}
                    <div class="actividad-card {% if act.completada %}done{% endif %}">
                        <div class="actividad-info">
                            <h3>{{ act.titulo }}</h3>
                            <span class="categoria">{{ act.categoria }}</span>

                            {% if act.completada %}
                                <span class="badge completada">Completada</span>
                            {% else %}
                                <span class="badge pendiente">Pendiente</span>
                            {% endif %}
                        </div>

                        <div class="acciones">
                            <a class="btn-completar" href="/completar/{{ loop.index0 }}">
                                Toggle
                            </a>

                            <a class="btn-eliminar"
                               onclick="return confirm('¬øSeguro que deseas eliminar esta actividad?')"
                               href="/eliminar/{{ loop.index0 }}">
                                Eliminar
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No hay actividades registradas.</p>
        {% endif %}
    </div>

    <!-- ========================= -->
    <!-- ASISTENTE IA -->
    <!-- ========================= -->

    <div class="card ai-card">
        <h2>Asistente Inteligente</h2>

        <a class="btn-ai" href="/recomendacion">
            Generar Recomendaci√≥n Inteligente
        </a>

        {% if recomendacion %}
            <div class="ai-response">
                <p>{{ recomendacion }}</p>
            </div>
        {% endif %}
    </div>

    <!-- ========================= -->
    <!-- DESCARGAR PDF -->
    <!-- ========================= -->

    <div class="card center">
        <a class="btn-pdf" href="/descargar_pdf">
            Descargar Reporte PDF
        </a>
    </div>

</div>

<script>
    const barra = document.querySelector('.barra');
    const mensaje = document.querySelector('.mensaje');

    if (barra) {
        const porcentaje = parseInt(barra.getAttribute('data-porcentaje'));

        setTimeout(() => {
            barra.style.width = porcentaje + '%';
        }, 300);

        if (mensaje) {
            if (porcentaje <= 30) {
                mensaje.style.color = "#ff4b5c";
            } else if (porcentaje <= 70) {
                mensaje.style.color = "#ffd93d";
            } else {
                mensaje.style.color = "#00ffa3";
            }
        }
    }
</script>

</body>
</html>